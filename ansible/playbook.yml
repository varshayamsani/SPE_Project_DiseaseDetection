---
# Main Ansible Playbook for Disease Detector DevOps Deployment
# This playbook orchestrates the complete deployment using modular roles

- name: Deploy Disease Detector Application
  hosts: all
  become: yes
  vars:
    app_name: disease-detector
    app_port: 5001
    docker_image_backend: "{{ docker_image_backend | default('varshayamsani/disease-detector-backend:latest') }}"
    docker_image_frontend: "{{ docker_image_frontend | default('varshayamsani/disease-detector-frontend:latest') }}"
    docker_registry: "{{ docker_registry | default('docker.io') }}"
    kubernetes_namespace: "{{ kubernetes_namespace | default('disease-detector') }}"
    
  roles:
    # Role 1: Common system setup
    - role: common
      tags: common
    
    # Role 2: Docker installation and setup
    - role: docker
      tags: docker
    
    # Role 3: Kubernetes setup and deployment
    - role: k8s
      tags: k8s
      vars:
        docker_image_backend: "{{ docker_image_backend }}"
        docker_image_frontend: "{{ docker_image_frontend }}"
        kubernetes_namespace: "{{ kubernetes_namespace }}"
    
    # Role 4: ELK Stack deployment
    - role: elk
      tags: elk
